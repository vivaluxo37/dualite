const { createClient } = require('@supabase/supabase-js');

// Supabase configuration
const supabaseUrl = 'https://efxpwrnxdorgzcqhbnfn.supabase.co';
const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVmeHB3cm54ZG9yZ3pjcWhibmZuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTcwMzMyMzUsImV4cCI6MjA3MjYwOTIzNX0.q2qAWQgNE1lTCTA8MBdzeNCm5rtL5a_7o4E1Hf_tmzQ';

const supabase = createClient(supabaseUrl, supabaseKey);

// New brokers to add (excluding existing ones)
const newBrokers = [
  {
    name: "OctaFX",
    slug: "octafx",
    website_url: "https://www.octafx.com",
    founded_year: 2013,
    headquarters: "St. Vincent and the Grenadines",
    country: "St. Vincent and the Grenadines",
    regulations: ["FSA Seychelles", "FCA", "CySEC", "FSCA"],
    minimum_deposit: 0,
    spreads_avg: 0,
    leverage_max: "1:1000",
    platforms: ["MT4", "MT5", "TradingView"],
    account_types: ["Classic Account", "Raw Account", "TradingView Raw"],
    instruments: ["Forex", "Commodities", "Cryptocurrencies", "Stock Indices", "Stocks and ETFs"],
    company_description: "Octa is a transparent international broker with low spreads and no swaps, offering a wide range of trading instruments and educational resources.",
    unique_features: ["Ultra-fast execution", "Safety of clients' funds", "Tight spreads", "Zero commissions"],
    customer_support: ["Dedicated support", "24/5 availability"],
    education_resources: ["Trading guides", "Market analysis", "Educational materials"],
    avg_rating: 9.0,
    trust_score: 9.0,
    is_active: true
  },
  {
    name: "City Index",
    slug: "city-index",
    website_url: "https://www.cityindex.com",
    founded_year: 1983,
    headquarters: "UK",
    country: "UK",
    regulations: ["FCA", "ASIC", "MAS"],
    minimum_deposit: 0,
    spreads_avg: 0.7,
    leverage_max: "1:200",
    platforms: ["MetaTrader 4", "Web Platform", "Mobile App"],
    account_types: ["Standard", "Professional", "Islamic"],
    instruments: ["Forex", "Indices", "Commodities", "Shares", "Cryptocurrencies", "ETFs"],
    company_description: "City Index is a global provider of CFD and forex trading services with over 35 years of experience.",
    unique_features: ["Competitive spreads", "Fast execution", "Comprehensive research", "Risk management tools"],
    customer_support: ["24/5 support", "Phone", "Email", "Live chat"],
    education_resources: ["Trading guides", "Webinars", "Market analysis", "Video tutorials"],
    avg_rating: 9.0,
    trust_score: 9.0,
    is_active: true
  },
  {
    name: "FXCM",
    slug: "fxcm",
    website_url: "https://www.fxcm.com",
    founded_year: 1999,
    headquarters: "UK",
    country: "UK",
    regulations: ["FCA", "ASIC", "CySEC", "FSCA", "ISA"],
    minimum_deposit: 50,
    spreads_avg: 1.1,
    leverage_max: "1:400",
    platforms: ["MetaTrader 4", "Trading Station", "NinjaTrader", "ZuluTrade"],
    account_types: ["Standard", "Professional", "Islamic"],
    instruments: ["Forex", "Indices", "Commodities", "Shares", "Cryptocurrencies", "ETFs"],
    company_description: "FXCM is a leading online forex and CFD broker offering competitive trading conditions and educational resources.",
    unique_features: ["No dealing desk", "Fast execution", "Educational resources", "Multiple platform options"],
    customer_support: ["24/5 support", "Phone", "Email", "Live chat"],
    education_resources: ["Trading courses", "Webinars", "Market analysis", "Video tutorials"],
    avg_rating: 8.8,
    trust_score: 8.8,
    is_active: true
  },
  {
    name: "TD Ameritrade",
    slug: "td-ameritrade",
    website_url: "https://www.tdameritrade.com",
    founded_year: 1975,
    headquarters: "USA",
    country: "USA",
    regulations: ["SEC", "FINRA", "SIPC"],
    minimum_deposit: 0,
    spreads_avg: 0,
    leverage_max: "1:50",
    platforms: ["thinkorswim", "Web Platform", "Mobile App"],
    account_types: ["Standard", "IRA", "Professional"],
    instruments: ["Forex", "Stocks", "Options", "Futures", "ETFs", "Mutual Funds"],
    company_description: "TD Ameritrade is a leading US brokerage firm offering a wide range of investment products and trading services.",
    unique_features: ["Advanced trading platform", "Extensive research", "Educational resources", "Commission-free trading"],
    customer_support: ["24/7 support", "Phone", "Email", "Live chat"],
    education_resources: ["Trading courses", "Webinars", "Market analysis", "Video tutorials"],
    avg_rating: 9.2,
    trust_score: 9.2,
    is_active: true
  },
  {
    name: "Interactive Brokers",
    slug: "interactive-brokers",
    website_url: "https://www.interactivebrokers.com",
    founded_year: 1978,
    headquarters: "USA",
    country: "USA",
    regulations: ["SEC", "FINRA", "SIPC", "FCA", "ASIC", "IIROC", "MAS"],
    minimum_deposit: 0,
    spreads_avg: 0,
    leverage_max: "1:50",
    platforms: ["Trader Workstation", "Web Platform", "Mobile App"],
    account_types: ["Individual", "Joint", "IRA", "Institutional"],
    instruments: ["Forex", "Stocks", "Options", "Futures", "ETFs", "Bonds", "Mutual Funds"],
    company_description: "Interactive Brokers is a global brokerage firm offering a wide range of investment products and trading services.",
    unique_features: ["Low commissions", "Global market access", "Advanced trading tools", "Margin lending"],
    customer_support: ["24/6 support", "Phone", "Email", "Live chat"],
    education_resources: ["Trading courses", "Webinars", "Market analysis", "Video tutorials"],
    avg_rating: 9.0,
    trust_score: 9.0,
    is_active: true
  },
  {
    name: "IG US",
    slug: "ig-us",
    website_url: "https://www.ig.com/us",
    founded_year: 1974,
    headquarters: "USA",
    country: "USA",
    regulations: ["CFTC", "NFA"],
    minimum_deposit: 0,
    spreads_avg: 0.8,
    leverage_max: "1:50",
    platforms: ["IG Web Platform", "Mobile App"],
    account_types: ["Standard", "Professional"],
    instruments: ["Forex", "Indices", "Commodities", "Cryptocurrencies", "ETFs"],
    company_description: "IG US is the US division of IG Group, offering forex and CFD trading services to US clients.",
    unique_features: ["Competitive spreads", "Fast execution", "Risk management tools", "Educational resources"],
    customer_support: ["24/5 support", "Phone", "Email", "Live chat"],
    education_resources: ["Trading guides", "Webinars", "Market analysis", "Video tutorials"],
    avg_rating: 8.9,
    trust_score: 8.9,
    is_active: true
  },
  {
    name: "ATC Brokers",
    slug: "atc-brokers",
    website_url: "https://www.atcbrokers.com",
    founded_year: 2005,
    headquarters: "USA",
    country: "USA",
    regulations: ["NFA", "FCA"],
    minimum_deposit: 5000,
    spreads_avg: 0,
    leverage_max: "1:100",
    platforms: ["MetaTrader 4", "MetaTrader 5"],
    account_types: ["Standard", "Professional", "Islamic"],
    instruments: ["Forex", "Indices", "Commodities", "Cryptocurrencies", "ETFs"],
    company_description: "ATC Brokers is a US-based forex broker offering STP execution and competitive trading conditions.",
    unique_features: ["STP execution", "No dealing desk", "Competitive spreads", "Fast execution"],
    customer_support: ["24/5 support", "Phone", "Email", "Live chat"],
    education_resources: ["Trading guides", "Webinars", "Market analysis", "Video tutorials"],
    avg_rating: 8.7,
    trust_score: 8.7,
    is_active: true
  },
  {
    name: "AxiTrader",
    slug: "axitrader",
    website_url: "https://www.axi.com",
    founded_year: 2007,
    headquarters: "Australia",
    country: "Australia",
    regulations: ["ASIC", "FCA", "FSCA"],
    minimum_deposit: 0,
    spreads_avg: 0,
    leverage_max: "1:400",
    platforms: ["MetaTrader 4", "MetaTrader 5"],
    account_types: ["Standard", "Pro", "Islamic"],
    instruments: ["Forex", "Indices", "Commodities", "Cryptocurrencies", "ETFs"],
    company_description: "AxiTrader is an Australian forex broker offering competitive trading conditions and educational resources.",
    unique_features: ["Competitive spreads", "Fast execution", "Educational resources", "Multiple regulatory licenses"],
    customer_support: ["24/5 support", "Phone", "Email", "Live chat"],
    education_resources: ["Trading courses", "Webinars", "Market analysis", "Video tutorials"],
    avg_rating: 8.8,
    trust_score: 8.8,
    is_active: true
  },
  {
    name: "ADSS",
    slug: "adss",
    website_url: "https://www.adss.com",
    founded_year: 2010,
    headquarters: "UAE",
    country: "UAE",
    regulations: ["FCA", "ADGM", "SFC"],
    minimum_deposit: 100,
    spreads_avg: 0.8,
    leverage_max: "1:500",
    platforms: ["MetaTrader 4", "MetaTrader 5", "ADSS Platform"],
    account_types: ["Classic", "Elite", "VIP", "Islamic"],
    instruments: ["Forex", "Indices", "Commodities", "Shares", "Cryptocurrencies", "ETFs"],
    company_description: "ADSS is a UAE-based forex and CFD broker offering competitive trading conditions and regional expertise.",
    unique_features: ["Regional focus", "Competitive spreads", "Fast execution", "Multiple regulatory licenses"],
    customer_support: ["24/5 support", "Phone", "Email", "Live chat"],
    education_resources: ["Trading guides", "Webinars", "Market analysis", "Video tutorials"],
    avg_rating: 9.0,
    trust_score: 9.0,
    is_active: true
  },
  {
    name: "ThinkMarkets",
    slug: "thinkmarkets",
    website_url: "https://www.thinkmarkets.com",
    founded_year: 2010,
    headquarters: "Australia",
    country: "Australia",
    regulations: ["ASIC", "FCA", "FSCA", "CySEC"],
    minimum_deposit: 0,
    spreads_avg: 0.4,
    leverage_max: "1:500",
    platforms: ["MetaTrader 4", "MetaTrader 5", "ThinkTrader", "Web Platform"],
    account_types: ["Standard", "Pro", "VIP", "Islamic"],
    instruments: ["Forex", "Indices", "Commodities", "Shares", "Cryptocurrencies", "ETFs"],
    company_description: "ThinkMarkets is an Australian forex and CFD broker offering competitive trading conditions and innovative technology.",
    unique_features: ["ThinkTrader platform", "Competitive spreads", "Fast execution", "Multiple regulatory licenses"],
    customer_support: ["24/5 support", "Phone", "Email", "Live chat"],
    education_resources: ["Trading guides", "Webinars", "Market analysis", "Video tutorials"],
    avg_rating: 8.8,
    trust_score: 8.8,
    is_active: true
  },
  {
    name: "FXPrimus",
    slug: "fxprimus",
    website_url: "https://www.fxprimus.com",
    founded_year: 2009,
    headquarters: "Vanuatu",
    country: "Vanuatu",
    regulations: ["VFSC", "FSC"],
    minimum_deposit: 100,
    spreads_avg: 1,
    leverage_max: "1:1000",
    platforms: ["MetaTrader 4", "MetaTrader 5"],
    account_types: ["PrimusClassic", "PrimusPro", "PrimusZero", "Islamic"],
    instruments: ["Forex", "Indices", "Commodities", "Cryptocurrencies", "ETFs"],
    company_description: "FXPrimus is a regulated online broker offering secure and efficient trading across multiple financial markets.",
    unique_features: ["Negative Balance Protection", "Fund security", "Copy trading", "Multiple regulatory licenses"],
    customer_support: ["24/5 support", "Phone", "Email", "Live chat"],
    education_resources: ["Trading guides", "Webinars", "Market analysis", "Video tutorials"],
    avg_rating: 8.6,
    trust_score: 8.6,
    is_active: true
  },
  {
    name: "FBS",
    slug: "fbs",
    website_url: "https://www.fbs.com",
    founded_year: 2009,
    headquarters: "Cyprus",
    country: "Cyprus",
    regulations: ["CySEC", "FCA", "FSCA", "IFSC"],
    minimum_deposit: 1,
    spreads_avg: 0,
    leverage_max: "1:3000",
    platforms: ["MetaTrader 4", "MetaTrader 5", "FBS App"],
    account_types: ["Cent", "Standard", "Zero Spread", "ECN", "Islamic"],
    instruments: ["Forex", "Indices", "Commodities", "Cryptocurrencies", "ETFs"],
    company_description: "FBS is a global forex and CFD broker offering competitive trading conditions and educational resources.",
    unique_features: ["High leverage", "Competitive spreads", "Educational resources", "Multiple regulatory licenses"],
    customer_support: ["24/7 support", "Phone", "Email", "Live chat"],
    education_resources: ["Trading courses", "Webinars", "Market analysis", "Video tutorials"],
    avg_rating: 9.3,
    trust_score: 9.3,
    is_active: true
  },
  {
    name: "Zerodha",
    slug: "zerodha",
    website_url: "https://www.zerodha.com",
    founded_year: 2010,
    headquarters: "Bangalore, India",
    country: "India",
    regulations: ["SEBI"],
    minimum_deposit: 0,
    spreads_avg: 0.01,
    leverage_max: "1:1000",
    platforms: ["Kite", "Coin", "Console"],
    account_types: ["Equity", "Commodity", "Currency", "IPO"],
    instruments: ["Stocks", "Futures", "Options", "Commodities", "Currency"],
    company_description: "Zerodha is India's largest retail stock broker offering flat fee brokerage and innovative trading platforms.",
    unique_features: ["Flat fee brokerage", "Zero brokerage for delivery", "Advanced trading platforms", "Educational resources"],
    customer_support: ["Phone", "Email", "Support portal"],
    education_resources: ["Trading courses", "Webinars", "Market analysis", "Video tutorials"],
    avg_rating: 9.5,
    trust_score: 9.5,
    is_active: true
  },
  {
    name: "ICICI Direct",
    slug: "icici-direct",
    website_url: "https://www.icicidirect.com",
    founded_year: 1996,
    headquarters: "Mumbai, India",
    country: "India",
    regulations: ["SEBI"],
    minimum_deposit: 0,
    spreads_avg: 0.015,
    leverage_max: "1:500",
    platforms: ["ICICI Direct App", "Web Platform"],
    account_types: ["Equity", "Commodity", "Currency", "Mutual Funds"],
    instruments: ["Stocks", "Futures", "Options", "Commodities", "Currency", "Mutual Funds"],
    company_description: "ICICI Securities is a leading online trading platform in India, offering a wide range of investment products including stocks, mutual funds, IPOs, and more.",
    unique_features: ["3-in-1 account", "Research reports", "Investment advisory", "Multiple investment products"],
    customer_support: ["Phone", "Email", "Branch support"],
    education_resources: ["Investment guides", "Market analysis", "Research reports"],
    avg_rating: 9.3,
    trust_score: 9.3,
    is_active: true
  },
  {
    name: "HDFC Securities",
    slug: "hdfc-securities",
    website_url: "https://www.hdfcsec.com",
    founded_year: 2000,
    headquarters: "Mumbai, India",
    country: "India",
    regulations: ["SEBI"],
    minimum_deposit: 0,
    spreads_avg: 0.015,
    leverage_max: "1:500",
    platforms: ["HDFC Securities App", "Web Platform"],
    account_types: ["Equity", "Commodity", "Currency", "Mutual Funds"],
    instruments: ["Stocks", "Futures", "Options", "Commodities", "Currency", "Mutual Funds"],
    company_description: "HDFC Securities is a leading financial services company offering a wide range of investment products and trading services.",
    unique_features: ["3-in-1 account", "Research reports", "Investment advisory", "Multiple investment products"],
    customer_support: ["Phone", "Email", "Branch support"],
    education_resources: ["Investment guides", "Market analysis", "Research reports"],
    avg_rating: 9.1,
    trust_score: 9.1,
    is_active: true
  },
  {
    name: "Sharekhan",
    slug: "sharekhan",
    website_url: "https://www.sharekhan.com",
    founded_year: 2000,
    headquarters: "Mumbai, India",
    country: "India",
    regulations: ["SEBI"],
    minimum_deposit: 0,
    spreads_avg: 0.02,
    leverage_max: "1:400",
    platforms: ["Sharekhan App", "Web Platform"],
    account_types: ["Equity", "Commodity", "Currency", "Mutual Funds"],
    instruments: ["Stocks", "Futures", "Options", "Commodities", "Currency", "Mutual Funds"],
    company_description: "Sharekhan is one of India's leading retail brokerage firms offering a wide range of investment products and trading services.",
    unique_features: ["Research reports", "Trading tips", "Investment advisory", "Multiple investment products"],
    customer_support: ["Phone", "Email", "Branch support"],
    education_resources: ["Investment guides", "Market analysis", "Research reports"],
    avg_rating: 8.9,
    trust_score: 8.9,
    is_active: true
  },
  {
    name: "Angel One",
    slug: "angel-one",
    website_url: "https://www.angelone.in",
    founded_year: 1996,
    headquarters: "Mumbai, India",
    country: "India",
    regulations: ["SEBI"],
    minimum_deposit: 0,
    spreads_avg: 0.02,
    leverage_max: "1:400",
    platforms: ["Angel One App", "Web Platform"],
    account_types: ["Equity", "Commodity", "Currency", "Mutual Funds"],
    instruments: ["Stocks", "Futures", "Options", "Commodities", "Currency", "Mutual Funds"],
    company_description: "Angel One is a leading financial services company offering a wide range of investment products and trading services.",
    unique_features: ["Flat fee brokerage", "Research reports", "Investment advisory", "Multiple investment products"],
    customer_support: ["Phone", "Email", "Branch support"],
    education_resources: ["Investment guides", "Market analysis", "Research reports"],
    avg_rating: 8.7,
    trust_score: 8.7,
    is_active: true
  },
  {
    name: "Motilal Oswal",
    slug: "motilal-oswal",
    website_url: "https://www.motilaloswal.com",
    founded_year: 1987,
    headquarters: "Mumbai, India",
    country: "India",
    regulations: ["SEBI"],
    minimum_deposit: 0,
    spreads_avg: 0.025,
    leverage_max: "1:300",
    platforms: ["Motilal Oswal App", "Web Platform"],
    account_types: ["Equity", "Commodity", "Currency", "Mutual Funds"],
    instruments: ["Stocks", "Futures", "Options", "Commodities", "Currency", "Mutual Funds"],
    company_description: "Motilal Oswal offers the best online stock trading platform in India. We're the leading Top broking house with the best online trading platform across all our financial products.",
    unique_features: ["Research reports", "Investment advisory", "Multiple investment products", "Wealth management"],
    customer_support: ["Phone", "Email", "Branch support"],
    education_resources: ["Investment guides", "Market analysis", "Research reports"],
    avg_rating: 8.5,
    trust_score: 8.5,
    is_active: true
  }
];

async function addBrokersToDatabase() {
  console.log('Starting to add brokers to database...');
  
  for (const broker of newBrokers) {
    try {
      console.log(`Adding broker: ${broker.name}`);
      
      const { data, error } = await supabase
        .from('brokers')
        .insert([{
          name: broker.name,
          slug: broker.slug,
          website_url: broker.website_url,
          established_year: broker.founded_year,
          headquarters_location: broker.headquarters,
          country: broker.country,
          regulations: broker.regulations,
          min_deposit: broker.minimum_deposit,
          spreads_avg: broker.spreads_avg,
          leverage_max: broker.leverage_max,
          platforms: broker.platforms,
          instruments: broker.instruments,
          company_description: broker.company_description,
          avg_rating: broker.avg_rating,
          trust_score: Math.round(broker.trust_score),
          is_active: broker.is_active,
          pros: broker.unique_features,
          support_channels: broker.customer_support,
          educational_materials: {
            resources: broker.education_resources
          },
          created_at: new Date().toISOString(),
          updated_at: new Date().toISOString()
        }])
        .select();
      
      if (error) {
        console.error(`Error adding ${broker.name}:`, error);
      } else {
        console.log(`Successfully added ${broker.name} to database`);
      }
      
      // Add a small delay to avoid rate limiting
      await new Promise(resolve => setTimeout(resolve, 500));
      
    } catch (error) {
      console.error(`Error processing ${broker.name}:`, error);
    }
  }
  
  console.log('Finished adding brokers to database');
}

addBrokersToDatabase().catch(console.error);